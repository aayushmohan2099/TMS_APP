{# fragment: dmmu/training_requests.html #}
<h4>Training Requests</h4>

{% if requests and requests.exists %}
  <div class="table-responsive">
    <table class="table table-sm table-bordered">
      <thead class="table-light">
        <tr>
          <th>Request ID</th>
          <th>Training</th>
          <th>Theme</th>
          <th>Level</th>
          <th>Requested by</th>
          <th>Beneficiaries</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for tr in requests %}
          {% with status=tr.status|default:""|upper %}
            <tr>
              <td>{{ tr.id }}</td>
              <td>{{ tr.training_plan.training_name }}</td>
              <td>{{ tr.training_plan.theme }}</td>
              <td>{{ tr.level }}</td>
              <td>
                {% if tr.created_by %}
                  {{ tr.created_by.get_full_name|default:tr.created_by.username }}
                {% else %}
                  &mdash;
                {% endif %}
              </td>
              <td>{{ tr.beneficiaries.count }}</td>
              <td>
                {% if status == "ONGOING" %}
                  <span class="badge bg-success">Approved</span>
                {% elif status == "COMPLETED" %}
                  <span class="badge bg-secondary">Completed</span>
                {% elif status == "REJECTED" %}
                  <span class="badge bg-danger">Rejected</span>
                {% else %}
                  <a class="btn btn-sm btn-primary" href="{% url 'dmmu_request_detail' tr.id %}">Open</a>
                {% endif %}
              </td>
            </tr>
          {% endwith %}
        {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <div class="text-muted">No training requests found.</div>
{% endif %}
