{% load humanize %}
<div>
  <h5>Batch: {{ batch.code|default:batch.id }} — Status: {{ batch.status }}</h5>
  <div class="small text-muted mb-2">
    Start: {{ batch.start_date|date:"Y-m-d"|default:"—" }} — End: {{ batch.end_date|date:"Y-m-d"|default:"—" }}
  </div>

  <div class="row g-3">
    <div class="col-md-6">
      <h6>Training partner & plan</h6>
      <div class="small">
        <div><strong>Training plan:</strong> {{ request_obj.training_plan.training_name|default:"—" }}</div>
        <div><strong>Partner:</strong> {{ request_obj.partner.name|default:"—" }}</div>
      </div>

      <h6 class="mt-3">Centre (short)</h6>
      <div class="small">
        <div><strong>Venue:</strong> {{ centre_info.venue_name|default:"—" }}</div>
        <div><strong>Address:</strong> {{ centre_info.venue_address|default:"—" }}</div>
        <div><strong>Coordinator:</strong> {{ centre_info.coord_name|default:"—" }} / {{ centre_info.coord_mobile|default:"—" }}</div>
      </div>
    </div>

    <div class="col-md-6">
      <h6>Trainers</h6>
      {% if trainers %}
        <ul class="list-unstyled small mb-0">
          {% for t in trainers %}
            <li>
              {# try common attributes, fallback to str(t) #}
              {% if t.full_name %}{{ t.full_name }}
              {% elif t.name %}{{ t.name }}
              {% elif t.get_full_name %}{{ t.get_full_name }}
              {% else %}{{ t }}{% endif %}
              {% if t.mobile_no %} / {{ t.mobile_no }}{% endif %}
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <div class="small text-muted">No trainers recorded.</div>
      {% endif %}

      <h6 class="mt-3">Participants (preview)</h6>
      {% if beneficiaries %}
        <div style="max-height:160px; overflow:auto;">
          <table class="table table-sm table-bordered mb-0">
            <thead class="table-light"><tr><th>Name</th><th>Mobile</th></tr></thead>
            <tbody>
              {% for bb in beneficiaries %}
                <tr>
                  <td>{{ bb.member_name|default:"—" }}</td>
                  <td>{{ bb.mobile_number|default:bb.mobile_no|default:"—" }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <div class="small text-muted">No beneficiaries attached to this batch.</div>
      {% endif %}
    </div>
  </div>

  <hr class="my-2">

  <h6>Dates & attendance</h6>
  {% if attendance_dates %}
    <div class="table-responsive">
      <table class="table table-sm table-bordered">
        <thead class="table-light"><tr><th>Date</th><th>Attendance records</th></tr></thead>
        <tbody>
          {% for d in attendance_dates %}
            {# IMPORTANT: data-date must be ISO (YYYY-MM-DD) so attendance URL works #}
            <tr class="attendance-date-row" data-batch-id="{{ batch.id }}" data-date="{{ d|date:'Y-m-d' }}">
              <td>{{ d|date:"Y-m-d" }}</td>
              <td id="attendance-{{ batch.id }}-{{ forloop.counter }}" class="small text-muted">Click to load attendance</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div id="attendancePlaceholder" class="mt-2"></div>
  {% else %}
    <div class="small text-muted">No attendance records found for this batch.</div>
  {% endif %}
</div>
