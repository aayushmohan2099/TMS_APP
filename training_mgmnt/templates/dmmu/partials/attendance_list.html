<div>
  <div class="d-flex justify-content-between align-items-center mb-2">
    <h6 class="mb-0">Attendance: {{ attendance.date|date:"Y-m-d" }}</h6>
    <div>
      <button type="button" class="btn btn-sm btn-outline-secondary" id="closeAttendanceBtn">Close</button>
    </div>
  </div>

  <div class="table-responsive">
    <table class="table table-sm table-bordered">
      <thead class="table-light"><tr><th>Name</th><th>Role</th><th>Present</th></tr></thead>
      <tbody>
        {% for r in attendance.participant_records.all %}
          <tr>
            <td>{{ r.participant_name }}</td>
            <td>{{ r.participant_role }}</td>
            <td>{% if r.present %}Yes{% else %}No{% endif %}</td>
          </tr>
        {% empty %}
          <tr><td colspan="3" class="small text-muted">No records</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <script>
    (function(){
      // Defensive: the element may be injected many times, so avoid duplicate listeners
      const btn = document.getElementById('closeAttendanceBtn');
      if (btn) {
        btn.addEventListener('click', function(){
          const placeholder = document.getElementById('attendancePlaceholder');
          if (placeholder) {
            placeholder.innerHTML = '';
          }
          // remove any loaded class on the date rows (so they can be clicked again)
          document.querySelectorAll('.attendance-date-row.loaded').forEach(r => r.classList.remove('loaded'));
          // scroll back to the dates table if present
          const datesTable = document.querySelector('.attendance-date-row');
          if (datesTable) {
            datesTable.scrollIntoView({behavior: 'smooth', block: 'center'});
          }
        }, { once: true });
      }
    })();
  </script>
</div>
